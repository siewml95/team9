// kmjs-test.js

// quick and dirty.

var colors = [
  [73,163,163],
  [73,54,40],
  [166,142,94],
  [141,63,41],
  [91,35,38],
  [111,110,116],
  [131,158,188],
  [210,127,123],
  [33,67,50],
  [163,171,107],
  [209,83,70],
  [132,163,161],
  [47,48,68],
  [91,130,169],
  [110,118,69]
];

$(window).load(function () {
  var kmTest = {};
  var str ='[{"x":696,"y":205},{"x":673,"y":204},{"x":634,"y":205},{"x":633,"y":204},{"x":603,"y":203},{"x":717,"y":198},{"x":714,"y":202},{"x":683,"y":194},{"x":677,"y":197},{"x":631,"y":201},{"x":677,"y":194},{"x":617,"y":198},{"x":602,"y":199},{"x":584,"y":210},{"x":546,"y":208},{"x":538,"y":206},{"x":537,"y":205},{"x":569,"y":201},{"x":533,"y":209},{"x":467,"y":210},{"x":512,"y":211},{"x":593,"y":200},{"x":543,"y":193},{"x":591,"y":195},{"x":446,"y":212},{"x":710,"y":212},{"x":709,"y":214},{"x":658,"y":215},{"x":661,"y":217},{"x":774,"y":218},{"x":776,"y":222},{"x":705,"y":218},{"x":701,"y":217},{"x":697,"y":223},{"x":779,"y":223},{"x":702,"y":223},{"x":660,"y":221},{"x":657,"y":214},{"x":588,"y":213},{"x":590,"y":212},{"x":547,"y":212},{"x":447,"y":212},{"x":507,"y":212},{"x":534,"y":213},{"x":538,"y":215},{"x":651,"y":213},{"x":654,"y":215},{"x":489,"y":217},{"x":582,"y":215},{"x":561,"y":218},{"x":581,"y":223},{"x":579,"y":223},{"x":563,"y":220},{"x":468,"y":218},{"x":545,"y":215},{"x":656,"y":218},{"x":441,"y":209},{"x":425,"y":192},{"x":700,"y":190},{"x":674,"y":190},{"x":638,"y":191},{"x":670,"y":187},{"x":626,"y":183},{"x":669,"y":184},{"x":615,"y":184},{"x":609,"y":180},{"x":608,"y":179},{"x":607,"y":179},{"x":614,"y":172},{"x":602,"y":174},{"x":602,"y":175},{"x":602,"y":177},{"x":557,"y":190},{"x":446,"y":189},{"x":595,"y":189},{"x":589,"y":180},{"x":591,"y":177},{"x":590,"y":175},{"x":591,"y":181},{"x":595,"y":174},{"x":596,"y":173},{"x":430,"y":169},{"x":741,"y":165},{"x":742,"y":167},{"x":654,"y":163},{"x":732,"y":161},{"x":734,"y":161},{"x":653,"y":165},{"x":550,"y":165},{"x":650,"y":165},{"x":488,"y":162},{"x":559,"y":160},{"x":651,"y":159},{"x":431,"y":157},{"x":729,"y":152},{"x":710,"y":149},{"x":706,"y":146},{"x":703,"y":144},{"x":701,"y":143},{"x":761,"y":141},{"x":761,"y":143},{"x":699,"y":142},{"x":697,"y":141},{"x":770,"y":138},{"x":764,"y":133},{"x":756,"y":139},{"x":733,"y":135},{"x":693,"y":139},{"x":690,"y":136},{"x":690,"y":137},{"x":669,"y":135},{"x":686,"y":135},{"x":668,"y":134},{"x":673,"y":134},{"x":669,"y":134},{"x":682,"y":133},{"x":691,"y":138},{"x":665,"y":132},{"x":754,"y":106},{"x":769,"y":118},{"x":749,"y":113},{"x":748,"y":105},{"x":744,"y":113},{"x":753,"y":80},{"x":739,"y":75},{"x":737,"y":124},{"x":738,"y":123},{"x":738,"y":113},{"x":739,"y":113},{"x":736,"y":80},{"x":733,"y":95},{"x":733,"y":86},{"x":726,"y":90},{"x":730,"y":92},{"x":728,"y":83},{"x":732,"y":80},{"x":729,"y":78},{"x":735,"y":76},{"x":740,"y":73},{"x":752,"y":52},{"x":745,"y":63},{"x":746,"y":65},{"x":742,"y":70},{"x":720,"y":65},{"x":726,"y":64},{"x":727,"y":63},{"x":725,"y":53},{"x":693,"y":130},{"x":695,"y":130},{"x":692,"y":131},{"x":675,"y":121},{"x":674,"y":119},{"x":670,"y":116},{"x":674,"y":114},{"x":665,"y":117},{"x":665,"y":122},{"x":662,"y":121},{"x":648,"y":113},{"x":646,"y":109},{"x":650,"y":114},{"x":653,"y":112},{"x":654,"y":117},{"x":656,"y":114},{"x":660,"y":117},{"x":678,"y":122},{"x":691,"y":127},{"x":683,"y":130},{"x":646,"y":157},{"x":639,"y":156},{"x":635,"y":152},{"x":624,"y":153},{"x":516,"y":155},{"x":517,"y":152},{"x":615,"y":148},{"x":528,"y":146},{"x":443,"y":144},{"x":619,"y":143},{"x":579,"y":143},{"x":582,"y":136},{"x":578,"y":142},{"x":577,"y":137},{"x":573,"y":136},{"x":572,"y":141},{"x":441,"y":135},{"x":643,"y":111},{"x":642,"y":111},{"x":634,"y":111},{"x":601,"y":131},{"x":598,"y":131},{"x":598,"y":123},{"x":590,"y":123},{"x":591,"y":123},{"x":594,"y":123},{"x":598,"y":123},{"x":603,"y":123},{"x":597,"y":123},{"x":596,"y":123},{"x":586,"y":110},{"x":645,"y":108},{"x":635,"y":108},{"x":636,"y":99},{"x":638,"y":100},{"x":640,"y":104},{"x":641,"y":106},{"x":633,"y":108},{"x":583,"y":103},{"x":623,"y":107},{"x":626,"y":103},{"x":627,"y":100},{"x":626,"y":103},{"x":613,"y":98},{"x":630,"y":99},{"x":631,"y":98},{"x":609,"y":97},{"x":605,"y":95},{"x":584,"y":92},{"x":587,"y":94},{"x":597,"y":90},{"x":588,"y":82},{"x":587,"y":86},{"x":586,"y":81},{"x":585,"y":82},{"x":584,"y":81},{"x":589,"y":61},{"x":592,"y":73},{"x":594,"y":89},{"x":633,"y":99},{"x":627,"y":108},{"x":583,"y":124},{"x":574,"y":120},{"x":569,"y":120},{"x":574,"y":120},{"x":579,"y":119},{"x":582,"y":86},{"x":578,"y":118},{"x":574,"y":119},{"x":568,"y":118},{"x":577,"y":117},{"x":576,"y":81},{"x":577,"y":81},{"x":577,"y":62},{"x":573,"y":76},{"x":571,"y":79},{"x":571,"y":75},{"x":572,"y":80},{"x":577,"y":77},{"x":573,"y":114},{"x":570,"y":113},{"x":572,"y":115},{"x":570,"y":117},{"x":568,"y":77},{"x":569,"y":79},{"x":569,"y":74},{"x":586,"y":133},{"x":567,"y":133},{"x":561,"y":128},{"x":567,"y":73},{"x":566,"y":77},{"x":566,"y":115},{"x":565,"y":117},{"x":559,"y":91},{"x":561,"y":84},{"x":558,"y":79},{"x":565,"y":72},{"x":564,"y":72},{"x":563,"y":63},{"x":562,"y":70},{"x":560,"y":60},{"x":562,"y":64},{"x":562,"y":75},{"x":560,"y":72},{"x":565,"y":118},{"x":558,"y":127},{"x":489,"y":120},{"x":556,"y":119},{"x":558,"y":89},{"x":557,"y":87},{"x":557,"y":85},{"x":557,"y":80},{"x":557,"y":75},{"x":555,"y":119},{"x":453,"y":108},{"x":457,"y":115},{"x":538,"y":105},{"x":526,"y":101},{"x":555,"y":81},{"x":549,"y":82},{"x":535,"y":79},{"x":542,"y":37},{"x":542,"y":37},{"x":544,"y":43},{"x":545,"y":49},{"x":539,"y":54},{"x":541,"y":59},{"x":535,"y":68},{"x":535,"y":62},{"x":530,"y":60},{"x":535,"y":58},{"x":530,"y":56},{"x":528,"y":59},{"x":522,"y":52},{"x":523,"y":53},{"x":525,"y":54},{"x":526,"y":55},{"x":528,"y":55},{"x":520,"y":56},{"x":516,"y":54},{"x":528,"y":59},{"x":508,"y":91},{"x":509,"y":91},{"x":508,"y":92},{"x":460,"y":95},{"x":506,"y":60},{"x":436,"y":138},{"x":430,"y":155},{"x":426,"y":184},{"x":415,"y":108},{"x":423,"y":149},{"x":403,"y":195},{"x":403,"y":125},{"x":402,"y":152},{"x":323,"y":184},{"x":327,"y":195},{"x":335,"y":195},{"x":238,"y":189},{"x":181,"y":200},{"x":179,"y":191},{"x":238,"y":189},{"x":250,"y":183},{"x":329,"y":175},{"x":349,"y":179},{"x":364,"y":173},{"x":253,"y":180},{"x":201,"y":175},{"x":141,"y":191},{"x":130,"y":206},{"x":122,"y":198},{"x":122,"y":203},{"x":122,"y":201},{"x":123,"y":191},{"x":375,"y":173},{"x":276,"y":169},{"x":265,"y":166},{"x":253,"y":161},{"x":354,"y":156},{"x":198,"y":160},{"x":164,"y":166},{"x":131,"y":153},{"x":360,"y":140},{"x":273,"y":141},{"x":219,"y":138},{"x":193,"y":149},{"x":187,"y":146},{"x":194,"y":142},{"x":135,"y":137},{"x":387,"y":137},{"x":211,"y":125},{"x":201,"y":126},{"x":200,"y":126},{"x":193,"y":120},{"x":165,"y":136},{"x":178,"y":137},{"x":259,"y":117},{"x":349,"y":107},{"x":264,"y":113},{"x":262,"y":115},{"x":235,"y":106},{"x":383,"y":91},{"x":375,"y":105},{"x":374,"y":106},{"x":338,"y":86},{"x":393,"y":65},{"x":391,"y":65},{"x":353,"y":34},{"x":380,"y":4},{"x":380,"y":5},{"x":369,"y":22},{"x":353,"y":35},{"x":334,"y":6},{"x":301,"y":59},{"x":314,"y":47},{"x":304,"y":45},{"x":295,"y":8},{"x":276,"y":24},{"x":284,"y":9},{"x":304,"y":32},{"x":231,"y":110},{"x":185,"y":113},{"x":220,"y":112},{"x":173,"y":88},{"x":142,"y":136},{"x":123,"y":152},{"x":121,"y":168},{"x":95,"y":135},{"x":94,"y":134},{"x":12,"y":126},{"x":10,"y":132},{"x":41,"y":125},{"x":25,"y":72},{"x":94,"y":101},{"x":23,"y":114},{"x":20,"y":119},{"x":2,"y":104},{"x":19,"y":112},{"x":374,"y":210},{"x":356,"y":218},{"x":240,"y":220},{"x":173,"y":217},{"x":178,"y":217},{"x":158,"y":220},{"x":156,"y":218},{"x":131,"y":213},{"x":130,"y":213},{"x":128,"y":217},{"x":362,"y":222},{"x":234,"y":223},{"x":366,"y":213},{"x":408,"y":224},{"x":803,"y":227},{"x":798,"y":231},{"x":789,"y":232},{"x":804,"y":233},{"x":709,"y":230},{"x":684,"y":233},{"x":693,"y":238},{"x":726,"y":239},{"x":729,"y":241},{"x":727,"y":243},{"x":795,"y":246},{"x":695,"y":240},{"x":693,"y":247},{"x":694,"y":244},{"x":694,"y":243},{"x":690,"y":235},{"x":690,"y":239},{"x":689,"y":237},{"x":683,"y":232},{"x":573,"y":225},{"x":539,"y":227},{"x":586,"y":229},{"x":576,"y":229},{"x":590,"y":230},{"x":597,"y":233},{"x":537,"y":232},{"x":526,"y":228},{"x":522,"y":233},{"x":680,"y":234},{"x":573,"y":234},{"x":528,"y":237},{"x":618,"y":240},{"x":602,"y":240},{"x":591,"y":240},{"x":616,"y":241},{"x":623,"y":247},{"x":620,"y":247},{"x":616,"y":244},{"x":572,"y":242},{"x":569,"y":245},{"x":542,"y":242},{"x":539,"y":244},{"x":541,"y":242},{"x":614,"y":245},{"x":553,"y":247},{"x":615,"y":247},{"x":535,"y":239},{"x":532,"y":242},{"x":528,"y":237},{"x":464,"y":246},{"x":526,"y":239},{"x":388,"y":248},{"x":750,"y":252},{"x":754,"y":252},{"x":786,"y":252},{"x":722,"y":253},{"x":791,"y":266},{"x":790,"y":255},{"x":755,"y":255},{"x":779,"y":264},{"x":722,"y":252},{"x":555,"y":248},{"x":617,"y":249},{"x":565,"y":252},{"x":560,"y":255},{"x":556,"y":253},{"x":515,"y":267},{"x":512,"y":258},{"x":505,"y":269},{"x":505,"y":265},{"x":427,"y":273},{"x":554,"y":275},{"x":500,"y":275},{"x":496,"y":274},{"x":495,"y":276},{"x":493,"y":277},{"x":477,"y":277},{"x":415,"y":278},{"x":558,"y":279},{"x":555,"y":279},{"x":503,"y":278},{"x":552,"y":279},{"x":770,"y":278},{"x":772,"y":280},{"x":504,"y":284},{"x":499,"y":285},{"x":497,"y":283},{"x":776,"y":281},{"x":488,"y":285},{"x":492,"y":287},{"x":492,"y":287},{"x":568,"y":292},{"x":569,"y":295},{"x":771,"y":289},{"x":488,"y":281},{"x":486,"y":289},{"x":486,"y":292},{"x":486,"y":288},{"x":481,"y":290},{"x":486,"y":287},{"x":477,"y":290},{"x":474,"y":293},{"x":487,"y":282},{"x":436,"y":298},{"x":766,"y":298},{"x":466,"y":299},{"x":474,"y":300},{"x":483,"y":301},{"x":464,"y":300},{"x":449,"y":307},{"x":466,"y":308},{"x":524,"y":308},{"x":455,"y":308},{"x":694,"y":360},{"x":693,"y":359},{"x":680,"y":350},{"x":679,"y":357},{"x":678,"y":365},{"x":675,"y":395},{"x":667,"y":343},{"x":669,"y":345},{"x":672,"y":346},{"x":673,"y":401},{"x":521,"y":324},{"x":521,"y":325},{"x":522,"y":325},{"x":494,"y":322},{"x":463,"y":311},{"x":463,"y":315},{"x":457,"y":313},{"x":458,"y":312},{"x":463,"y":314},{"x":459,"y":315},{"x":467,"y":317},{"x":473,"y":321},{"x":492,"y":322},{"x":460,"y":325},{"x":461,"y":325},{"x":463,"y":325},{"x":488,"y":324},{"x":506,"y":328},{"x":588,"y":342},{"x":577,"y":344},{"x":584,"y":345},{"x":527,"y":331},{"x":525,"y":331},{"x":517,"y":330},{"x":478,"y":330},{"x":455,"y":325},{"x":461,"y":345},{"x":455,"y":339},{"x":458,"y":349},{"x":570,"y":361},{"x":462,"y":350},{"x":453,"y":309},{"x":452,"y":324},{"x":450,"y":329},{"x":446,"y":377},{"x":431,"y":345},{"x":452,"y":312},{"x":428,"y":303},{"x":428,"y":292},{"x":424,"y":321},{"x":420,"y":322},{"x":386,"y":293},{"x":396,"y":322},{"x":417,"y":284},{"x":385,"y":257},{"x":384,"y":394},{"x":383,"y":225},{"x":171,"y":224},{"x":117,"y":225},{"x":382,"y":226},{"x":223,"y":228},{"x":225,"y":228},{"x":231,"y":228},{"x":329,"y":243},{"x":340,"y":244},{"x":325,"y":253},{"x":326,"y":255},{"x":343,"y":257},{"x":322,"y":273},{"x":304,"y":274},{"x":299,"y":261},{"x":299,"y":265},{"x":261,"y":239},{"x":258,"y":251},{"x":256,"y":249},{"x":234,"y":252},{"x":277,"y":259},{"x":255,"y":262},{"x":250,"y":260},{"x":260,"y":258},{"x":242,"y":258},{"x":240,"y":257},{"x":235,"y":255},{"x":233,"y":255},{"x":232,"y":263},{"x":231,"y":265},{"x":230,"y":235},{"x":228,"y":250},{"x":220,"y":229},{"x":221,"y":233},{"x":222,"y":235},{"x":219,"y":239},{"x":226,"y":248},{"x":231,"y":254},{"x":219,"y":265},{"x":220,"y":263},{"x":234,"y":266},{"x":258,"y":269},{"x":218,"y":271},{"x":297,"y":273},{"x":284,"y":275},{"x":302,"y":276},{"x":372,"y":288},{"x":364,"y":283},{"x":350,"y":282},{"x":344,"y":280},{"x":326,"y":280},{"x":339,"y":278},{"x":339,"y":284},{"x":298,"y":290},{"x":362,"y":323},{"x":367,"y":323},{"x":368,"y":299},{"x":367,"y":293},{"x":342,"y":291},{"x":340,"y":321},{"x":338,"y":321},{"x":323,"y":312},{"x":331,"y":320},{"x":306,"y":324},{"x":327,"y":325},{"x":300,"y":326},{"x":302,"y":333},{"x":300,"y":332},{"x":300,"y":339},{"x":321,"y":336},{"x":327,"y":336},{"x":327,"y":348},{"x":302,"y":350},{"x":325,"y":349},{"x":327,"y":351},{"x":332,"y":325},{"x":334,"y":305},{"x":296,"y":282},{"x":295,"y":276},{"x":295,"y":285},{"x":296,"y":351},{"x":296,"y":317},{"x":295,"y":288},{"x":277,"y":290},{"x":272,"y":290},{"x":268,"y":289},{"x":293,"y":294},{"x":244,"y":303},{"x":240,"y":303},{"x":237,"y":303},{"x":247,"y":305},{"x":245,"y":305},{"x":233,"y":305},{"x":234,"y":302},{"x":233,"y":302},{"x":232,"y":305},{"x":229,"y":303},{"x":224,"y":304},{"x":227,"y":305},{"x":224,"y":301},{"x":224,"y":294},{"x":294,"y":306},{"x":294,"y":320},{"x":294,"y":315},{"x":291,"y":307},{"x":287,"y":319},{"x":287,"y":320},{"x":282,"y":329},{"x":270,"y":310},{"x":269,"y":311},{"x":267,"y":310},{"x":257,"y":312},{"x":256,"y":327},{"x":256,"y":311},{"x":251,"y":311},{"x":254,"y":311},{"x":248,"y":326},{"x":258,"y":346},{"x":247,"y":342},{"x":247,"y":310},{"x":279,"y":349},{"x":290,"y":349},{"x":290,"y":311},{"x":291,"y":309},{"x":295,"y":301},{"x":217,"y":303},{"x":218,"y":351},{"x":295,"y":352},{"x":326,"y":353},{"x":229,"y":354},{"x":226,"y":352},{"x":227,"y":355},{"x":224,"y":352},{"x":216,"y":351},{"x":214,"y":288},{"x":214,"y":288},{"x":213,"y":291},{"x":213,"y":258},{"x":214,"y":255},{"x":216,"y":249},{"x":213,"y":293},{"x":213,"y":263},{"x":213,"y":260},{"x":212,"y":262},{"x":210,"y":248},{"x":213,"y":294},{"x":210,"y":294},{"x":207,"y":243},{"x":207,"y":283},{"x":209,"y":294},{"x":213,"y":298},{"x":206,"y":289},{"x":204,"y":272},{"x":211,"y":339},{"x":216,"y":355},{"x":252,"y":359},{"x":300,"y":361},{"x":298,"y":372},{"x":298,"y":364},{"x":269,"y":362},{"x":266,"y":361},{"x":282,"y":364},{"x":296,"y":367},{"x":236,"y":390},{"x":323,"y":368},{"x":326,"y":355},{"x":332,"y":368},{"x":231,"y":372},{"x":204,"y":377},{"x":203,"y":297},{"x":203,"y":298},{"x":200,"y":313},{"x":197,"y":386},{"x":192,"y":232},{"x":194,"y":243},{"x":186,"y":270},{"x":169,"y":238},{"x":179,"y":239},{"x":172,"y":239},{"x":172,"y":243},{"x":167,"y":264},{"x":167,"y":250},{"x":162,"y":265},{"x":161,"y":269},{"x":163,"y":266},{"x":165,"y":259},{"x":168,"y":240},{"x":195,"y":274},{"x":174,"y":299},{"x":175,"y":299},{"x":170,"y":306},{"x":162,"y":300},{"x":162,"y":370},{"x":185,"y":323},{"x":195,"y":304},{"x":161,"y":277},{"x":154,"y":290},{"x":198,"y":388},{"x":165,"y":393},{"x":162,"y":398},{"x":154,"y":394},{"x":186,"y":401},{"x":191,"y":393},{"x":148,"y":237},{"x":111,"y":233},{"x":130,"y":247},{"x":128,"y":246},{"x":143,"y":267},{"x":126,"y":269},{"x":123,"y":301},{"x":59,"y":251},{"x":25,"y":295},{"x":0,"y":245},{"x":3,"y":272},{"x":4,"y":283},{"x":25,"y":295},{"x":7,"y":300},{"x":126,"y":305},{"x":115,"y":361},{"x":3,"y":310},{"x":79,"y":313},{"x":70,"y":317},{"x":67,"y":316},{"x":95,"y":307},{"x":93,"y":317},{"x":57,"y":332},{"x":6,"y":334},{"x":3,"y":330},{"x":19,"y":336},{"x":23,"y":335},{"x":89,"y":341},{"x":65,"y":343},{"x":78,"y":343},{"x":75,"y":347},{"x":89,"y":348},{"x":92,"y":353},{"x":96,"y":316},{"x":109,"y":359},{"x":94,"y":361},{"x":91,"y":359},{"x":89,"y":375},{"x":74,"y":381}]';
  var items = JSON.parse(str);
  var k = new kmpp();

  var resultsPP = [];
  var resultsRandom = [];

  kmTest.initCanvas = function () {
    var canvas = document.getElementById('canv');
    canvas.width = $('#wrapper').innerWidth();
    canvas.height = $('#wrapper').innerHeight();

    var ctx = canvas.getContext('2d');
    var timer = null;
    $('#canv').live('click', function () {
      if (timer) return;

      if (k.converged === true) {

      } else {
        var t = Date.now();
        k.cluster(function () {
          var ms = Date.now() - t;
          if (k.kmpp === true) {
            resultsPP.push(ms);
          } else {
            resultsRandom.push(ms);
          }
          kmTest.clearCanvas();
          kmTest.drawPoints();
          kmTest.drawCentroids();
          k.kmpp = !k.kmpp;
          k.setPoints(items);
          k.guessK();
          k.initCentroids();

          ctx.font = 'bold 13px sans';
          ctx.fillStyle = 'rgba(0,0,0,1)';
          ctx.fillText('Click to restart clustering',10,48);
          ctx.fillText(ms+'ms',10,62);

        });
      }
    });
  };

  kmTest.clearCanvas = function () {
    var canvas = document.getElementById('canv');
    var ctx = canvas.getContext('2d');
    ctx.font = '13px sans'
    ctx.fillStyle = 'rgba(255,255,255,1)';
    ctx.fillRect(0,0,canvas.width, canvas.height);
    ctx.fillStyle = 'rgba(0,0,0,1)';
    if (k.converged === false && k.iterations === 0) {
      ctx.font = 'bold 13px sans';
      ctx.fillStyle = 'rgba(0,0,0,1)';
      ctx.fillText('Click to start clustering',10,48);
      return;
    }

    ctx.fillText('Iterations : ' + k.iterations,10,20);
    ctx.fillText('initial centroids: '+(k.kmpp ? 'km++' : 'random'),10,34);
  };

  kmTest.drawPoints = function () {
    var canvas = document.getElementById('canv');
    var ctx = canvas.getContext('2d');
    ctx.fillStyle = 'rgba(255,0,0,1)';

    for (var i = 0; i < k.points.length; ++i) {
      var centroid = k.points[i].centroid;
      if (typeof centroid !== 'number') centroid = 0;
      if (centroid > colors.length-1) centroid = centroid % colors.length;
      ctx.fillStyle = ['rgba(', colors[centroid].join(','),  ',1)'].join('');
      // console.log()
      ctx.fillRect(k.points[i].x,k.points[i].y,5,5);
    }
  };

  kmTest.drawCentroids = function () {
    var canvas = document.getElementById('canv');
    var ctx = canvas.getContext('2d');
    ctx.font = 'bold 12px sans';
    ctx.shadowColor ='rgba(0,0,0,1)';
    ctx.shadowOffsetX = 0;
    ctx.shadowOffsetY = 0;
    ctx.shadowBlur = 12;

    for (var i = 0; i < k.centroids.length; ++i) {
      if (!k.centroids[i].items) {
        ctx.fillStyle = 'rgba(255,0,0,0.5)';
      } else {
        ctx.fillStyle = 'rgba(0,0,255,0.5)';
      }
      ctx.fillRect(k.centroids[i].x-10,k.centroids[i].y-10,20,20);
      ctx.fillStyle = 'rgba(255,255,255,1)';
      ctx.fillText( k.centroids[i].centroid, k.centroids[i].x-8,k.centroids[i].y+5);
    }
    ctx.shadowBlur = 0;
  };

  kmTest.initCanvas();
  kmTest.clearCanvas();

  k.setPoints(items);
  k.guessK();
  k.initCentroids();
  kmTest.drawPoints();
  kmTest.drawCentroids();

});

